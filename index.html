<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ø±Ø± Ù‚ØµØ§Ø¦Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #0f172a; color: white; }
        .card { background: #1e293b; border-radius: 15px; transition: 0.3s; cursor: pointer; }
        .card:hover { border-color: #6366f1; transform: translateY(-5px); }
        .gradient-btn { background: linear-gradient(90deg, #6366f1 0%, #a855f7 100%); transition: 0.3s; }
        .input-field { background: #334155; border: 1px solid #475569; border-radius: 10px; padding: 12px; outline: none; width: 100%; text-align: center; }
        .loading-bar { height: 4px; background: #6366f1; width: 0%; transition: 0.4s; }
    </style>
</head>
<body class="p-5 md:p-10">

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold mb-2">âœ¨ Ø£Ø¯Ø§Ø© ØµÙ†Ø§Ø¹Ø© Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù‚ØµØ§Ø¦Ø¯</h1>
            <p class="text-gray-400">Ø§Ø³ØªÙ‚Ø·Ø¹ØŒ Ø§Ø¯Ù…Ø¬ØŒ ÙˆØ§Ù†Ø´Ø± Ø±ÙŠÙ„Ø² Ø¨Ø¶ØºØ·Ø© Ø²Ø±</p>
            <div id="statusBox" class="mt-4 hidden">
                <div class="w-full bg-slate-800 rounded-full h-1.5 mb-2">
                    <div id="progressBar" class="loading-bar rounded-full"></div>
                </div>
                <p id="statusMsg" class="text-xs text-indigo-400 animate-pulse"></p>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <button onclick="showSection('cut')" class="card p-6 border-2 border-transparent focus:border-purple-500">
                <div class="text-3xl mb-2">ğŸµ</div>
                <h3 class="font-bold">Ø§Ø³ØªÙ‚Ø·Ø§Ø¹ (MP3)</h3>
            </button>
            <button onclick="showSection('mix')" class="card p-6 border-2 border-transparent focus:border-blue-500">
                <div class="text-3xl mb-2">ğŸ¬</div>
                <h3 class="font-bold">Ø¯Ù…Ø¬ Ù…Ø¹ ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯</h3>
            </button>
            <button onclick="showSection('reel')" class="card p-6 border-2 border-transparent focus:border-green-500">
                <div class="text-3xl mb-2">ğŸ“±</div>
                <h3 class="font-bold">ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Reel</h3>
            </button>
        </div>

        <div id="cut-section" class="card p-8 shadow-2xl border border-slate-700">
            <h2 class="text-2xl font-bold mb-6 border-r-4 border-purple-500 pr-3">1. Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØµÙˆØª Ø§Ù„Ù‚ØµÙŠØ¯Ø© (MP3)</h2>
            <div class="space-y-4">
                <input type="file" id="f1" accept="video/*" class="w-full text-sm text-gray-400 file:bg-purple-600 file:text-white file:rounded-lg file:px-4 file:py-2 file:border-0">
                <div class="grid grid-cols-2 gap-4">
                    <input type="text" id="s1" placeholder="Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (01:20)" class="input-field">
                    <input type="text" id="e1" placeholder="Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (01:50)" class="input-field">
                </div>
                <button onclick="execute('mp3')" class="gradient-btn w-full py-4 rounded-xl font-bold text-lg mt-4 shadow-lg">Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØª</button>
            </div>
        </div>

        <div id="mix-section" class="card p-8 shadow-2xl border border-slate-700 hidden">
            <h2 class="text-2xl font-bold mb-6 border-r-4 border-blue-500 pr-3">2. Ø¯Ù…Ø¬ ØµÙˆØª Ø§Ù„Ù‚ØµÙŠØ¯Ø© Ù…Ø¹ ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯</h2>
            <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="file" id="f2a" accept="video/*" class="text-xs" title="ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù‚ØµÙŠØ¯Ø©">
                    <input type="file" id="f2v" accept="video/*" class="text-xs" title="ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø®Ù„ÙÙŠØ©">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <input type="text" id="s2" placeholder="Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØµÙˆØª (00:10)" class="input-field">
                    <input type="text" id="e2" placeholder="Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØµÙˆØª (00:40)" class="input-field">
                </div>
                <button onclick="execute('mix')" class="bg-blue-600 w-full py-4 rounded-xl font-bold text-lg mt-4 hover:bg-blue-700 transition">Ø¥Ù†ØªØ§Ø¬ Ø±ÙŠÙ„ Ù…Ø¯Ù…Ø¬</button>
            </div>
        </div>

        <div id="reel-section" class="card p-8 shadow-2xl border border-slate-700 hidden">
            <h2 class="text-2xl font-bold mb-6 border-r-4 border-green-500 pr-3">3. ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¥Ù„Ù‰ Reel (Smart Crop)</h2>
            <div class="space-y-4">
                <input type="file" id="f3" accept="video/*" class="w-full">
                <div class="grid grid-cols-2 gap-4">
                    <input type="text" id="s3" placeholder="Ù…Ù† (01:20)" class="input-field">
                    <input type="text" id="e3" placeholder="Ø¥Ù„Ù‰ (01:50)" class="input-field">
                </div>
                <div class="bg-slate-800 p-4 rounded-lg">
                    <p class="text-sm text-gray-400 italic">Ø³ÙŠØªÙ… Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ ÙˆØ¬Ù‡ Ø§Ù„Ù…Ù†Ø´Ø¯ ÙˆØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø¥Ù„Ù‰ 9:16 ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.</p>
                </div>
                <button onclick="execute('smart')" class="bg-green-600 w-full py-4 rounded-xl font-bold text-lg mt-4 hover:bg-green-700 transition">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ ÙˆØªØ­Ù…ÙŠÙ„</button>
            </div>
        </div>

    </div>

    <script>
        const { createFFmpeg, fetchFile } = FFmpeg;
        const ffmpeg = createFFmpeg({ log: true });

        function showSection(section) {
            document.getElementById('cut-section').classList.add('hidden');
            document.getElementById('mix-section').classList.add('hidden');
            document.getElementById('reel-section').classList.add('hidden');
            document.getElementById(section + '-section').classList.remove('hidden');
        }

        function toSeconds(t) {
            const p = t.trim().split(':').reverse();
            return p.reduce((acc, v, i) => acc + parseInt(v) * Math.pow(60, i), 0);
        }

        async function execute(mode) {
            const statusBox = document.getElementById('statusBox');
            const statusMsg = document.getElementById('statusMsg');
            const progressBar = document.getElementById('progressBar');

            try {
                statusBox.classList.remove('hidden');
                if (!ffmpeg.isLoaded()) {
                    statusMsg.innerText = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø±Ùƒ...";
                    await ffmpeg.load();
                }

                let out = "result.mp4", args = [];
                progressBar.style.width = "30%";

                if(mode === 'mp3') {
                    const f = document.getElementById('f1').files[0];
                    const s = toSeconds(document.getElementById('s1').value);
                    const d = toSeconds(document.getElementById('e1').value) - s;
                    ffmpeg.FS('writeFile', 'i.mp4', await fetchFile(f));
                    out = "audio.mp3";
                    args = ['-ss', s.toString(), '-i', 'i.mp4', '-t', d.toString(), '-q:a', '0', '-map', 'a', out];
                } 
                else if(mode === 'mix') {
                    const fa = document.getElementById('f2a').files[0];
                    const fv = document.getElementById('f2v').files[0];
                    const s = toSeconds(document.getElementById('s2').value);
                    const d = toSeconds(document.getElementById('e2').value) - s;
                    ffmpeg.FS('writeFile', 'audio.mp4', await fetchFile(fa));
                    ffmpeg.FS('writeFile', 'video.mp4', await fetchFile(fv));
                    args = ['-i', 'video.mp4', '-ss', s.toString(), '-i', 'audio.mp4', '-t', d.toString(), '-vf', 'crop=ih*(9/16):ih,scale=720:1280', '-map', '0:v', '-map', '1:a', '-shortest', out];
                }
                else {
                    const f = document.getElementById('f3').files[0];
                    const s = toSeconds(document.getElementById('s3').value);
                    const d = toSeconds(document.getElementById('e3').value) - s;
                    ffmpeg.FS('writeFile', 'i.mp4', await fetchFile(f));
                    // Smart Crop: ÙŠØ±ÙƒØ² Ø¹Ù„Ù‰ Ù…Ù†ØªØµÙ Ø§Ù„ÙƒØ§Ø¯Ø± (Ø§Ù„Ù…Ù†Ø´Ø¯)
                    args = ['-ss', s.toString(), '-i', 'i.mp4', '-t', d.toString(), '-vf', 'crop=ih*(9/16):ih:(iw-ow)/2:0,scale=720:1280', out];
                }

                statusMsg.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©... Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹";
                progressBar.style.width = "60%";
                await ffmpeg.run(...args);

                progressBar.style.width = "100%";
                statusMsg.innerText = "Ø§ÙƒØªÙ…Ù„! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";

                const data = ffmpeg.FS('readFile', out);
                const url = URL.createObjectURL(new Blob([data.buffer], { type: mode==='mp3'?'audio/mp3':'video/mp4' }));
                const a = document.createElement('a'); a.href = url; a.download = out; a.click();

            } catch (e) {
                statusMsg.innerText = "Ø®Ø·Ø£: ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø³ØªØ¶Ø§ÙØ© (COOP/COEP)";
                console.error(e);
            }
        }
    </script>
</body>
</html>
