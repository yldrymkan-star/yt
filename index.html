<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ø±Ø± Ø§Ù„Ù‚ØµØ§Ø¦Ø¯ Ø§Ù„Ø°ÙƒÙŠ - Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #0f172a; color: white; overflow-x: hidden; }
        .card { background: #1e293b; border-radius: 20px; border: 1px solid #334155; }
        .gradient-btn { background: linear-gradient(90deg, #6366f1 0%, #a855f7 100%); transition: 0.3s; }
        .gradient-btn:hover { transform: scale(1.02); filter: brightness(1.1); }
        .input-style { background: #0f172a; border: 1px solid #334155; padding: 12px; border-radius: 12px; outline: none; text-align: center; width: 100%; color: #cbd5e1; }
        .input-style:focus { border-color: #6366f1; box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2); }
        .tab-btn { padding: 12px 24px; border-radius: 12px; transition: 0.3s; font-weight: bold; color: #94a3b8; }
        .active-tab { background: #6366f1; color: white; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4); }
        .loading-bar { height: 6px; background: #6366f1; width: 0%; transition: 0.4s; border-radius: 10px; }
    </style>
</head>
<body class="p-4 md:p-10">

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold mb-3 bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-purple-400 font-serif">âœ¨ Ù…Ø­Ø±Ø± Ø§Ù„Ù‚ØµØ§Ø¦Ø¯ Ø§Ù„Ø°ÙƒÙŠ</h1>
            <p class="text-gray-400">ØªØ­ÙˆÙŠÙ„ØŒ Ø¯Ù…Ø¬ØŒ ÙˆÙ‚Øµ Ø§Ù„Ù‚ØµØ§Ø¦Ø¯ Ø¨ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©</p>
            
            <div id="statusContainer" class="mt-8 hidden max-w-md mx-auto">
                <div class="w-full bg-slate-800 rounded-full h-2 mb-2">
                    <div id="progressBar" class="loading-bar"></div>
                </div>
                <p id="statusMsg" class="text-xs text-indigo-300 font-bold animate-pulse">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±...</p>
            </div>
        </header>

        <div class="flex flex-wrap justify-center gap-3 mb-8">
            <button onclick="showSection('cut')" id="btn-cut" class="tab-btn active-tab border border-indigo-500/30">ğŸµ Ø§Ø³ØªØ®Ø±Ø§Ø¬ MP3</button>
            <button onclick="showSection('mix')" id="btn-mix" class="tab-btn border border-slate-700">ğŸ¬ Ø¯Ù…Ø¬ Ø±ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
            <button onclick="showSection('reel')" id="btn-reel" class="tab-btn border border-slate-700">ğŸ“± ØªØ­ÙˆÙŠÙ„ Reel Ø°ÙƒÙŠ</button>
        </div>

        <div id="cut-section" class="card p-8 shadow-2xl space-y-6">
            <div class="flex items-center gap-3 mb-2">
                <div class="w-2 h-8 bg-indigo-500 rounded-full"></div>
                <h2 class="text-xl font-bold">1. Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØµÙˆØª Ø§Ù„Ù‚ØµÙŠØ¯Ø© (MP3)</h2>
            </div>
            <input type="file" id="f1" accept="video/*" class="w-full text-sm text-slate-400 file:bg-indigo-600 file:text-white file:rounded-lg file:px-4 file:py-2 file:border-0 file:ml-4 file:cursor-pointer">
            <div class="grid grid-cols-2 gap-4">
                <input type="text" id="s1" placeholder="Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (Ù…Ø«Ù„Ø§Ù‹ 00:10)" class="input-style font-mono">
                <input type="text" id="e1" placeholder="Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (Ù…Ø«Ù„Ø§Ù‹ 00:40)" class="input-style font-mono">
            </div>
            <button onclick="process('mp3')" class="gradient-btn w-full py-4 rounded-xl font-bold text-lg shadow-lg">Ø¨Ø¯Ø¡ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØª</button>
        </div>

        <div id="mix-section" class="card p-8 shadow-2xl hidden space-y-6">
            <div class="flex items-center gap-3 mb-2">
                <div class="w-2 h-8 bg-blue-500 rounded-full"></div>
                <h2 class="text-xl font-bold">2. Ø¯Ù…Ø¬ Ø§Ù„ØµÙˆØª Ù…Ø¹ Ø®Ù„ÙÙŠØ© ÙÙŠØ¯ÙŠÙˆ</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-2">
                    <label class="text-xs text-gray-400 mr-2">ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù‚ØµÙŠØ¯Ø© (Ù…ØµØ¯Ø± Ø§Ù„ØµÙˆØª):</label>
                    <input type="file" id="f2a" accept="video/*" class="w-full text-xs">
                </div>
                <div class="space-y-2">
                    <label class="text-xs text-gray-400 mr-2">ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø®Ù„ÙÙŠØ© (Ù…ØµØ¯Ø± Ø§Ù„ØµÙˆØ±Ø©):</label>
                    <input type="file" id="f2v" accept="video/*" class="w-full text-xs">
                </div>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <input type="text" id="s2" placeholder="Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØµÙˆØª" class="input-style font-mono">
                <input type="text" id="e2" placeholder="Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØµÙˆØª" class="input-style font-mono">
            </div>
            <button onclick="process('mix')" class="bg-blue-600 hover:bg-blue-700 w-full py-4 rounded-xl font-bold text-lg transition shadow-lg">Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø±ÙŠÙ„ Ø§Ù„Ù…Ø¯Ù…Ø¬</button>
        </div>

        <div id="reel-section" class="card p-8 shadow-2xl hidden space-y-6">
            <div class="flex items-center gap-3 mb-2">
                <div class="w-2 h-8 bg-green-500 rounded-full"></div>
                <h2 class="text-xl font-bold">3. Smart Crop (ØªØ­ÙˆÙŠÙ„ Ù„Ù€ 9:16)</h2>
            </div>
            <input type="file" id="f3" accept="video/*" class="w-full">
            <div class="grid grid-cols-2 gap-4">
                <input type="text" id="s3" placeholder="Ù…Ù† (00:00)" class="input-style font-mono">
                <input type="text" id="e3" placeholder="Ø¥Ù„Ù‰ (00:30)" class="input-style font-mono">
            </div>
            <p class="text-[11px] text-green-400 bg-green-500/10 p-3 rounded-lg border border-green-500/20 leading-relaxed">
                âœ¨ <b>Ù…Ù„Ø§Ø­Ø¸Ø© Ø°ÙƒÙŠØ©:</b> Ø³ÙŠÙ‚ÙˆÙ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù‚Øµ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆØªØºÙŠÙŠØ± Ø£Ø¨Ø¹Ø§Ø¯Ù‡ Ù„ÙŠÙ†Ø§Ø³Ø¨ Instagram Reels Ùˆ TikTok Ù…Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù„Ù‰ ÙˆØ³Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ.
            </p>
            <button onclick="process('smart')" class="bg-green-600 hover:bg-green-700 w-full py-4 rounded-xl font-bold text-lg transition shadow-lg">ØªØ­ÙˆÙŠÙ„ ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±ÙŠÙ„</button>
        </div>
    </div>

    <script>
        const { createFFmpeg, fetchFile } = FFmpeg;
        const ffmpeg = createFFmpeg({ log: true });

        // Ø¯Ø§Ù„Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª Ø¥Ù„Ù‰ Ø«ÙˆØ§Ù†Ù
        function timeToSec(t) {
            if (!t || t.trim() === "") return null;
            const p = t.trim().split(':').reverse();
            return p.reduce((acc, v, i) => acc + parseInt(v) * Math.pow(60, i), 0);
        }

        // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        function showSection(id) {
            ['cut', 'mix', 'reel'].forEach(s => {
                document.getElementById(s + '-section').classList.add('hidden');
                document.getElementById('btn-' + s).classList.remove('active-tab', 'border-indigo-500/30');
            });
            document.getElementById(id + '-section').classList.remove('hidden');
            document.getElementById('btn-' + id).classList.add('active-tab', 'border-indigo-500/30');
        }

        async function process(mode) {
            const statusContainer = document.getElementById('statusContainer');
            const statusMsg = document.getElementById('statusMsg');
            const progressBar = document.getElementById('progressBar');

            try {
                let start, end, file1, file2, out;
                
                // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†Ù…Ø· Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
                if (mode === 'mp3') {
                    file1 = document.getElementById('f1').files[0];
                    start = timeToSec(document.getElementById('s1').value);
                    end = timeToSec(document.getElementById('e1').value);
                    out = "audio_result.mp3";
                } else if (mode === 'mix') {
                    file1 = document.getElementById('f2a').files[0];
                    file2 = document.getElementById('f2v').files[0];
                    start = timeToSec(document.getElementById('s2').value);
                    end = timeToSec(document.getElementById('e2').value);
                    out = "mixed_reel.mp4";
                } else {
                    file1 = document.getElementById('f3').files[0];
                    start = timeToSec(document.getElementById('s3').value);
                    end = timeToSec(document.getElementById('e3').value);
                    out = "smart_reel.mp4";
                }

                if (!file1) { alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø£ÙˆÙ„Ø§Ù‹!"); return; }

                statusContainer.classList.remove('hidden');
                progressBar.style.width = "15%";
                statusMsg.innerText = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø­Ø±Ùƒ FFmpeg...";

                if (!ffmpeg.isLoaded()) await ffmpeg.load();

                statusMsg.innerText = "Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©...";
                progressBar.style.width = "35%";
                
                ffmpeg.FS('writeFile', 'input1.mp4', await fetchFile(file1));
                if (file2) ffmpeg.FS('writeFile', 'input2.mp4', await fetchFile(file2));

                statusMsg.innerText = "Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙÙ†ÙŠØ© (Ù‚Ø¯ ØªØ³ØªØºØ±Ù‚ Ø¯Ù‚ÙŠÙ‚Ø©)...";
                progressBar.style.width = "60%";

                // Ø¨Ù†Ø§Ø¡ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
                let args = [];
                const timeArgs = (start !== null && end !== null) ? ['-ss', start.toString(), '-t', (end - start).toString()] : [];

                if (mode === 'mp3') {
                    args = [...timeArgs, '-i', 'input1.mp4', '-q:a', '0', '-map', 'a', out];
                } else if (mode === 'mix') {
                    // Ø¯Ù…Ø¬ ÙÙŠØ¯ÙŠÙˆ 1 (ØµÙˆØª) Ù…Ø¹ ÙÙŠØ¯ÙŠÙˆ 2 (ØµÙˆØ±Ø©) Ù…Ø¹ Ù‚Øµ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯
                    args = ['-i', 'input2.mp4', ...timeArgs, '-i', 'input1.mp4', '-vf', 'crop=ih*(9/16):ih:(iw-ow)/2:0,scale=720:1280', '-map', '0:v', '-map', '1:a', '-shortest', out];
                } else {
                    // ØªØ­ÙˆÙŠÙ„ Ø°ÙƒÙŠ Ù„Ù„Ø£Ø¨Ø¹Ø§Ø¯ ÙÙ‚Ø·
                    args = [...timeArgs, '-i', 'input1.mp4', '-vf', 'crop=ih*(9/16):ih:(iw-ow)/2:0,scale=720:1280', '-c:v', 'libx264', '-preset', 'ultrafast', out];
                }

                await ffmpeg.run(...args);
                
                progressBar.style.width = "100%";
                statusMsg.innerText = "Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©! Ø¬Ø§Ø±ÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";

                const data = ffmpeg.FS('readFile', out);
                const url = URL.createObjectURL(new Blob([data.buffer], { type: mode === 'mp3' ? 'audio/mp3' : 'video/mp4' }));
                const a = document.createElement('a');
                a.href = url;
                a.download = out;
                a.click();

            } catch (e) {
                console.error(e);
                statusMsg.innerText = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©! ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØµÙŠØº ÙˆØ§Ù„ÙˆÙ‚Øª.";
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ COOP/COEP ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±.");
            }
        }
    </script>
</body>
</html>
