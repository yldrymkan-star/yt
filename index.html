<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ø±Ø± Ø§Ù„Ù‚ØµØ§Ø¦Ø¯ Ø§Ù„Ø°ÙƒÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #0f172a; color: white; }
        .card { background: #1e293b; border-radius: 15px; transition: 0.3s; cursor: pointer; border: 2px solid transparent; }
        .card:hover { transform: translateY(-5px); border-color: #6366f1; }
        .gradient-btn { background: linear-gradient(90deg, #6366f1 0%, #a855f7 100%); transition: 0.3s; }
        .input-field { background: #334155; border: 1px solid #475569; border-radius: 10px; padding: 12px; outline: none; width: 100%; text-align: center; color: white; }
        .loading-bar { height: 5px; background: #6366f1; width: 0%; transition: 0.4s; }
    </style>
</head>
<body class="p-5 md:p-10">

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold mb-2 text-indigo-400">âœ¨ Ø£Ø¯Ø§Ø© ØµÙ†Ø§Ø¹Ø© Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù‚ØµØ§Ø¦Ø¯</h1>
            <p class="text-gray-400">Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© | Ù…Ø¹Ø§Ù„Ø¬Ø© ÙƒØ§Ù…Ù„Ø© Ø£Ùˆ Ø¨Ø§Ø³ØªÙ‚Ø·Ø§Ø¹</p>
            <div id="statusBox" class="mt-6 hidden max-w-lg mx-auto">
                <div class="w-full bg-slate-800 rounded-full h-1.5 mb-2">
                    <div id="progressBar" class="loading-bar rounded-full"></div>
                </div>
                <p id="statusMsg" class="text-xs text-indigo-300 animate-pulse"></p>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <div onclick="showSection('cut')" class="card p-6 text-center">
                <div class="text-4xl mb-2">ğŸµ</div>
                <h3 class="font-bold">Ø§Ø³ØªÙ‚Ø·Ø§Ø¹ (MP3)</h3>
            </div>
            <div onclick="showSection('mix')" class="card p-6 text-center">
                <div class="text-4xl mb-2">ğŸ¬</div>
                <h3 class="font-bold">Ø¯Ù…Ø¬ Ù…Ø¹ ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯</h3>
            </div>
            <div onclick="showSection('reel')" class="card p-6 text-center">
                <div class="text-4xl mb-2">ğŸ“±</div>
                <h3 class="font-bold">ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Reel</h3>
            </div>
        </div>

        <div id="cut-section" class="card p-8 shadow-2xl">
            <h2 class="text-2xl font-bold mb-6 border-r-4 border-purple-500 pr-3">1. Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØµÙˆØª Ø§Ù„Ù‚ØµÙŠØ¯Ø© (MP3)</h2>
            <div class="space-y-4">
                <input type="file" id="f1" accept="video/*" class="w-full text-sm text-gray-400 file:bg-purple-600 file:text-white file:rounded-lg file:px-4 file:py-2 file:border-0">
                <div class="grid grid-cols-2 gap-4">
                    <input type="text" id="s1" placeholder="Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" class="input-field font-mono">
                    <input type="text" id="e1" placeholder="Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" class="input-field font-mono">
                </div>
                <button onclick="execute('mp3')" class="gradient-btn w-full py-4 rounded-xl font-bold text-lg mt-4 shadow-lg">Ø¨Ø¯Ø¡ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØª</button>
            </div>
        </div>

        <div id="mix-section" class="card p-8 shadow-2xl hidden">
            <h2 class="text-2xl font-bold mb-6 border-r-4 border-blue-500 pr-3">2. Ø¯Ù…Ø¬ ØµÙˆØª Ø§Ù„Ù‚ØµÙŠØ¯Ø© Ù…Ø¹ ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯</h2>
            <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-1">
                        <label class="text-xs text-gray-400">ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù‚ØµÙŠØ¯Ø© (Ù„Ù„ØµÙˆØª):</label>
                        <input type="file" id="f2a" accept="video/*" class="text-xs">
                    </div>
                    <div class="space-y-1">
                        <label class="text-xs text-gray-400">ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø®Ù„ÙÙŠØ© (Ù„Ù„ØµÙˆØ±Ø©):</label>
                        <input type="file" id="f2v" accept="video/*" class="text-xs">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <input type="text" id="s2" placeholder="Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØµÙˆØª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" class="input-field">
                    <input type="text" id="e2" placeholder="Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØµÙˆØª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" class="input-field">
                </div>
                <button onclick="execute('mix')" class="bg-blue-600 w-full py-4 rounded-xl font-bold text-lg mt-4 hover:bg-blue-700">Ø¥Ù†ØªØ§Ø¬ Ø±ÙŠÙ„ Ù…Ø¯Ù…Ø¬</button>
            </div>
        </div>

        <div id="reel-section" class="card p-8 shadow-2xl hidden">
            <h2 class="text-2xl font-bold mb-6 border-r-4 border-green-500 pr-3">3. ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¥Ù„Ù‰ Reel (Smart Crop)</h2>
            <div class="space-y-4">
                <input type="file" id="f3" accept="video/*" class="w-full">
                <div class="grid grid-cols-2 gap-4">
                    <input type="text" id="s3" placeholder="Ù…Ù† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" class="input-field">
                    <input type="text" id="e3" placeholder="Ø¥Ù„Ù‰ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" class="input-field">
                </div>
                <button onclick="execute('smart')" class="bg-green-600 w-full py-4 rounded-xl font-bold text-lg mt-4 hover:bg-green-700">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ ÙˆØªØ­Ù…ÙŠÙ„</button>
            </div>
        </div>
    </div>

    <script>
        const { createFFmpeg, fetchFile } = FFmpeg;
        const ffmpeg = createFFmpeg({ log: true });

        function showSection(id) {
            ['cut', 'mix', 'reel'].forEach(s => document.getElementById(s + '-section').classList.add('hidden'));
            document.getElementById(id + '-section').classList.remove('hidden');
        }

        function toSec(t) {
            if (!t || t.trim() === "") return null;
            const p = t.trim().split(':').reverse();
            return p.reduce((acc, v, i) => acc + parseInt(v) * Math.pow(60, i), 0);
        }

        async function execute(mode) {
            const statusBox = document.getElementById('statusBox');
            const statusMsg = document.getElementById('statusMsg');
            const progressBar = document.getElementById('progressBar');

            try {
                statusBox.classList.remove('hidden');
                if (!ffmpeg.isLoaded()) {
                    statusMsg.innerText = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø±Ùƒ...";
                    await ffmpeg.load();
                }

                let out = "result.mp4", args = [], start, end, file1, file2;

                if (mode === 'mp3') {
                    file1 = document.getElementById('f1').files[0];
                    start = toSec(document.getElementById('s1').value);
                    end = toSec(document.getElementById('e1').value);
                    out = "audio_only.mp3";
                } else if (mode === 'mix') {
                    file1 = document.getElementById('f2a').files[0];
                    file2 = document.getElementById('f2v').files[0];
                    start = toSec(document.getElementById('s2').value);
                    end = toSec(document.getElementById('e2').value);
                    out = "mixed_reel.mp4";
                } else {
                    file1 = document.getElementById('f3').files[0];
                    start = toSec(document.getElementById('s3').value);
                    end = toSec(document.getElementById('e3').value);
                    out = "smart_reel.mp4";
                }

                if (!file1) { alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù!"); return; }

                statusMsg.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙˆØ§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...";
                progressBar.style.width = "40%";
                ffmpeg.FS('writeFile', 'input1.mp4', await fetchFile(file1));
                if (file2) ffmpeg.FS('writeFile', 'input2.mp4', await fetchFile(file2));

                // Ø¨Ù†Ø§Ø¡ Ø£Ù…Ø± FFmpeg
                const timeArgs = (start !== null && end !== null) ? ['-ss', start.toString(), '-t', (end - start).toString()] : [];

                if (mode === 'mp3') {
                    args = [...timeArgs, '-i', 'input1.mp4', '-q:a', '0', '-map', 'a', out];
                } else if (mode === 'mix') {
                    args = ['-i', 'input2.mp4', ...timeArgs, '-i', 'input1.mp4', '-vf', 'crop=ih*(9/16):ih:(iw-ow)/2:0,scale=720:1280', '-map', '0:v', '-map', '1:a', '-shortest', out];
                } else {
                    args = [...timeArgs, '-i', 'input1.mp4', '-vf', 'crop=ih*(9/16):ih:(iw-ow)/2:0,scale=720:1280', out];
                }

                progressBar.style.width = "70%";
                await ffmpeg.run(...args);
                progressBar.style.width = "100%";

                const data = ffmpeg.FS('readFile', out);
                const url = URL.createObjectURL(new Blob([data.buffer], { type: mode === 'mp3' ? 'audio/mp3' : 'video/mp4' }));
                const a = document.createElement('a'); a.href = url; a.download = out; a.click();
                statusMsg.innerText = "Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„! âœ¨";

            } catch (e) {
                statusMsg.innerText = "Ø®Ø·Ø£! ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ù„Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (COOP/COEP)";
                console.error(e);
            }
        }
    </script>
</body>
</html>
