<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ø±Ø± Ø§Ù„Ù‚ØµØ§Ø¦Ø¯ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #0f172a; color: white; min-height: 100vh; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠØ© */
        .nav-card { 
            background: #1e293b; 
            border: 2px solid #334155; 
            border-radius: 20px; 
            transition: 0.3s all ease; 
            cursor: pointer; 
        }
        .nav-card:hover { transform: translateY(-8px); border-color: #6366f1; background: #24334d; }
        .nav-card.active { border-color: #6366f1; background: #1e1b4b; box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
        .input-large { 
            background: #0f172a; 
            border: 2px solid #334155; 
            padding: 16px; 
            border-radius: 15px; 
            font-size: 1.1rem; 
            width: 100%; 
            outline: none; 
            text-align: center;
        }
        .input-large:focus { border-color: #6366f1; box-shadow: 0 0 10px rgba(99, 102, 241, 0.2); }

        .btn-action { 
            background: linear-gradient(90deg, #6366f1 0%, #a855f7 100%); 
            padding: 18px; 
            border-radius: 15px; 
            font-weight: bold; 
            font-size: 1.2rem; 
            transition: 0.3s; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .btn-action:hover { filter: brightness(1.2); transform: scale(1.01); }

        .section-container { display: none; animation: fadeIn 0.4s ease; }
        .section-container.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="p-4 md:p-12">

    <div class="max-w-5xl mx-auto">
        <header class="text-center mb-12">
            <h1 class="text-5xl font-extrabold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-purple-400">âœ¨ ØµØ§Ù†Ø¹ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù‚ØµØ§Ø¦Ø¯</h1>
            <p class="text-gray-400 text-lg">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø§Ù„Ù‚ÙŠØ§Ù… Ø¨Ù‡Ø§ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            <div onclick="showSection('cut')" id="tab-cut" class="nav-card active p-8 text-center">
                <div class="text-5xl mb-4">ğŸµ</div>
                <h3 class="text-xl font-bold">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØª</h3>
                <p class="text-sm text-gray-400 mt-2">ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¥Ù„Ù‰ MP3 Ù…Ø¹ Ø§Ù„Ù‚Øµ</p>
            </div>
            
            <div onclick="showSection('mix')" id="tab-mix" class="nav-card p-8 text-center">
                <div class="text-5xl mb-4">ğŸ¬</div>
                <h3 class="text-xl font-bold">Ø¯Ù…Ø¬ Ø±ÙŠÙ„ Ù…Ø®ØµØµ</h3>
                <p class="text-sm text-gray-400 mt-2">Ø¯Ù…Ø¬ ØµÙˆØª Ù‚ØµÙŠØ¯Ø© Ù…Ø¹ ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯</p>
            </div>

            <div onclick="showSection('reel')" id="tab-reel" class="nav-card p-8 text-center">
                <div class="text-5xl mb-4">ğŸ“±</div>
                <h3 class="text-xl font-bold">Smart Reel</h3>
                <p class="text-sm text-gray-400 mt-2">ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ù„ØªÙ†Ø§Ø³Ø¨ Ø±ÙŠÙ„Ø² ÙˆØªÙŠÙƒ ØªÙˆÙƒ</p>
            </div>
        </div>

        <div id="statusContainer" class="hidden mb-10 p-6 bg-slate-800/50 border border-indigo-500/30 rounded-2xl">
            <div class="flex justify-between mb-2">
                <span id="statusMsg" class="text-indigo-300 font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</span>
                <span id="percentText" class="text-indigo-400">0%</span>
            </div>
            <div class="w-full bg-slate-900 rounded-full h-4 overflow-hidden">
                <div id="progressBar" class="bg-gradient-to-r from-indigo-500 to-purple-500 h-full w-0 transition-all duration-300"></div>
            </div>
        </div>

        <div id="cut-section" class="section-container active bg-[#1e293b] p-10 rounded-[30px] border border-slate-700 shadow-2xl">
            <h2 class="text-2xl font-bold mb-8 flex items-center gap-3">
                <span class="w-2 h-8 bg-indigo-500 rounded-full"></span> 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ø³ØªØ®Ø±Ø§Ø¬ MP3
            </h2>
            <div class="space-y-8">
                <div class="bg-[#0f172a] p-6 rounded-2xl border border-dashed border-slate-600">
                    <label class="block text-gray-400 mb-3 text-sm">Ø§Ø®ØªØ± ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù‚ØµÙŠØ¯Ø©:</label>
                    <input type="file" id="f1" accept="video/*" class="w-full text-indigo-300">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-gray-400 mb-2 mr-2">ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input type="text" id="s1" placeholder="Ù…Ø«Ø§Ù„: 00:05" class="input-large font-mono">
                    </div>
                    <div>
                        <label class="block text-gray-400 mb-2 mr-2">ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input type="text" id="e1" placeholder="Ù…Ø«Ø§Ù„: 01:20" class="input-large font-mono">
                    </div>
                </div>
                <button onclick="process('mp3')" class="btn-action w-full text-white">Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬</button>
            </div>
        </div>

        <div id="mix-section" class="section-container bg-[#1e293b] p-10 rounded-[30px] border border-slate-700 shadow-2xl">
            <h2 class="text-2xl font-bold mb-8 flex items-center gap-3">
                <span class="w-2 h-8 bg-blue-500 rounded-full"></span> 2. Ø¯Ù…Ø¬ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ø§Ù„ØµÙˆØª
            </h2>
            <div class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-[#0f172a] p-5 rounded-2xl border border-slate-700">
                        <label class="text-xs text-blue-400 block mb-2 font-bold">ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ù†Ø´Ø¯ (Ù„Ù„ØµÙˆØª):</label>
                        <input type="file" id="f2a" accept="video/*" class="w-full text-sm">
                    </div>
                    <div class="bg-[#0f172a] p-5 rounded-2xl border border-slate-700">
                        <label class="text-xs text-blue-400 block mb-2 font-bold">ÙÙŠØ¯ÙŠÙˆ Ø§Ù„ØªØµÙˆÙŠØ± (Ù„Ù„ØµÙˆØ±Ø©):</label>
                        <input type="file" id="f2v" accept="video/*" class="w-full text-sm">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-6">
                    <input type="text" id="s2" placeholder="Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØµÙˆØª" class="input-large">
                    <input type="text" id="e2" placeholder="Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØµÙˆØª" class="input-large">
                </div>
                <button onclick="process('mix')" class="btn-action w-full bg-gradient-to-r from-blue-600 to-indigo-600">Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø±ÙŠÙ„ Ø§Ù„Ù…Ø¯Ù…Ø¬</button>
            </div>
        </div>

        <div id="reel-section" class="section-container bg-[#1e293b] p-10 rounded-[30px] border border-slate-700 shadow-2xl">
            <h2 class="text-2xl font-bold mb-8 flex items-center gap-3">
                <span class="w-2 h-8 bg-green-500 rounded-full"></span> 3. ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ (9:16)
            </h2>
            <div class="space-y-8">
                <input type="file" id="f3" accept="video/*" class="input-large">
                <div class="grid grid-cols-2 gap-6">
                    <input type="text" id="s3" placeholder="Ù…Ù† ÙˆÙ‚Øª" class="input-large">
                    <input type="text" id="e3" placeholder="Ø¥Ù„Ù‰ ÙˆÙ‚Øª" class="input-large">
                </div>
                <div class="bg-green-500/10 p-4 rounded-xl border border-green-500/20 text-green-300 text-center text-sm italic">
                    Ø³ÙŠØªÙ… Ù‚Øµ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù„ÙŠÙ†Ø§Ø³Ø¨ ÙˆØ¶Ø¹ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© ÙÙŠ Ø§Ù„Ù‡Ø§ØªÙ Ø¨Ø´ÙƒÙ„ Ø§Ø­ØªØ±Ø§ÙÙŠ.
                </div>
                <button onclick="process('smart')" class="btn-action w-full bg-gradient-to-r from-green-600 to-teal-600">ØªØ­ÙˆÙŠÙ„ ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢Ù†</button>
            </div>
        </div>
    </div>

    <script>
        const { createFFmpeg, fetchFile } = FFmpeg;
        const ffmpeg = createFFmpeg({ log: true });

        function toSeconds(t) {
            if (!t || t.trim() === "") return null;
            const p = t.trim().split(':').reverse();
            return p.reduce((acc, v, i) => acc + parseInt(v) * Math.pow(60, i), 0);
        }

        function showSection(id) {
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙƒÙ„ ÙˆØ¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø·
            document.querySelectorAll('.section-container').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-card').forEach(c => c.classList.remove('active'));
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø®ØªØ§Ø± ÙˆØªÙ†Ø´ÙŠØ· Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
            document.getElementById(id + '-section').classList.add('active');
            document.getElementById('tab-' + id).classList.add('active');
        }

        async function process(mode) {
            const statusBox = document.getElementById('statusContainer');
            const statusMsg = document.getElementById('statusMsg');
            const progressBar = document.getElementById('progressBar');
            const percentText = document.getElementById('percentText');

            try {
                let f1, f2, start, end, out;
                
                if(mode === 'mp3') {
                    f1 = document.getElementById('f1').files[0];
                    start = toSeconds(document.getElementById('s1').value);
                    end = toSeconds(document.getElementById('e1').value);
                    out = "voice_poem.mp3";
                } else if(mode === 'mix') {
                    f1 = document.getElementById('f2a').files[0];
                    f2 = document.getElementById('f2v').files[0];
                    start = toSeconds(document.getElementById('s2').value);
                    end = toSeconds(document.getElementById('e2').value);
                    out = "mixed_poem.mp4";
                } else {
                    f1 = document.getElementById('f3').files[0];
                    start = toSeconds(document.getElementById('s3').value);
                    end = toSeconds(document.getElementById('e3').value);
                    out = "smart_reel.mp4";
                }

                if (!f1) { alert("Ù„Ø·ÙØ§Ù‹ Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹"); return; }

                statusBox.classList.remove('hidden');
                statusMsg.innerText = "Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ø±Ùƒ...";
                progressBar.style.width = "20%";
                percentText.innerText = "20%";

                if (!ffmpeg.isLoaded()) await ffmpeg.load();

                statusMsg.innerText = "Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
                progressBar.style.width = "40%";
                percentText.innerText = "40%";

                ffmpeg.FS('writeFile', 'file1.mp4', await fetchFile(f1));
                if (f2) ffmpeg.FS('writeFile', 'file2.mp4', await fetchFile(f2));

                const timeArgs = (start !== null && end !== null) ? ['-ss', start.toString(), '-t', (end - start).toString()] : [];

                let cmd = [];
                if (mode === 'mp3') {
                    cmd = [...timeArgs, '-i', 'file1.mp4', '-q:a', '0', '-map', 'a', out];
                } else if (mode === 'mix') {
                    cmd = ['-i', 'file2.mp4', ...timeArgs, '-i', 'file1.mp4', '-vf', 'crop=ih*(9/16):ih:(iw-ow)/2:0,scale=720:1280', '-map', '0:v', '-map', '1:a', '-shortest', out];
                } else {
                    cmd = [...timeArgs, '-i', 'file1.mp4', '-vf', 'crop=ih*(9/16):ih:(iw-ow)/2:0,scale=720:1280', out];
                }

                statusMsg.innerText = "Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø¬Ø§Ø±ÙŠØ©...";
                progressBar.style.width = "75%";
                percentText.innerText = "75%";

                await ffmpeg.run(...cmd);

                progressBar.style.width = "100%";
                percentText.innerText = "100%";
                statusMsg.innerText = "ØªÙ… Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†Ø²ÙŠÙ„...";

                const data = ffmpeg.FS('readFile', out);
                const url = URL.createObjectURL(new Blob([data.buffer], { type: mode === 'mp3' ? 'audio/mp3' : 'video/mp4' }));
                const a = document.createElement('a'); a.href = url; a.download = out; a.click();

            } catch (err) {
                console.error(err);
                statusMsg.innerText = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©!";
            }
        }
    </script>
</body>
</html>
